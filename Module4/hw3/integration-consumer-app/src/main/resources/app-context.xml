<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:camel="http://camel.apache.org/schema/spring"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
                        http://www.springframework.org/schema/beans/spring-beans-4.1.xsd
                        http://www.springframework.org/schema/context
                        http://www.springframework.org/schema/context/spring-context-4.1.xsd
                        http://camel.apache.org/schema/spring 
                        http://camel.apache.org/schema/spring/camel-spring.xsd">

    <context:property-placeholder location="classpath:app.properties" />
    
    <context:annotation-config />

    <bean id="connectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
        <property name="brokerURL" value="${app.activemq.broker.url}" />
    </bean>

    <bean id="activemq" class="org.apache.activemq.camel.component.ActiveMQComponent">
        <property name="connectionFactory" ref="connectionFactory" />
    </bean>

    <camel:camelContext id="camelContext">

        <camel:dataFormats>
            <camel:json id="jacksonJsonMarshaller" library="Jackson" unmarshalTypeName="com.epam.cdp.hnyp.architecture.integration.producer.ArifmeticCommand" />
        </camel:dataFormats>

        <camel:route>
            <camel:from uri="timer://generateTimer?period=${app.messages.generateInterval}" />
            <camel:to uri="bean:" />
            <camel:log message="" />
        </camel:route> 
        
    </camel:camelContext>
    
    <bean id="calculatorFactory" class="com.epam.cdp.hnyp.calculator.factory.impl.SimpleCalculatorFactory" />
    <bean id="calculator" class="com.epam.cdp.hnyp.calculator.Calculator" 
        factory-bean="calculatorFactory" factory-method="createCalculator" />
        
    <bean id="arifmeticCommandExecutor" class="com.epam.cdp.hnyp.architecture.integration.consumer.ArifmeticCommandExecutor" />

</beans>
